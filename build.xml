<project name="AbcLinuxu" basedir="." default="deploy">

  <property name="src" value="src" />
  <property name="data" value="../data" />
  <property name="build" value="../deploy" />
  <property name="build-firma" value="../firma" />

  <path id="project.classpath">
    <fileset dir="libs">
      <include name="*.jar" />
    </fileset>
  </path>


  <target name="init">

    <mkdir dir="${build}" />
    <mkdir dir="${build}/WEB-INF" />
    <mkdir dir="${build}/WEB-INF/lib" />
    <mkdir dir="${build}/WEB-INF/classes" />
    <mkdir dir="${build}/WEB-INF/velocity" />
    <mkdir dir="${build}/WEB-INF/logs" />
    <mkdir dir="${build}/auto" />
    <mkdir dir="${build-firma}" />
    <tstamp />

  </target>


  <target name="clean">

    <delete dir="${build}/WEB-INF/classes" />

  </target>


  <target name="build" depends="init">

    <javac srcdir="src" destdir="${build}/WEB-INF/classes" classpathref="project.classpath" debug="on" />
    <javac srcdir="test" destdir="${build}/WEB-INF/classes" classpathref="project.classpath" />

  </target>


  <target name="deploy-abc" depends="build">

    <copy todir="${build}/WEB-INF">
      <fileset dir="conf">
        <include name="web.xml" />
        <include name="templates.xml" />
        <include name="log4j.xml" />
        <include name="velocity.properties" />
      </fileset>
    </copy>

    <copy todir="${build}/WEB-INF/velocity">
      <fileset dir="web/velocity" />
      <fileset dir="conf" includes="macros.vm" />
    </copy>

    <copy todir="${build}/ikony">
      <fileset dir="${data}/web/ikony" />
    </copy>

    <copy todir="${build}/images">
      <fileset dir="${data}/web/images" />
    </copy>

    <copy todir="${build}">
      <fileset dir="${data}/web/root" />
      <fileset dir="web/root" />
    </copy>

    <copy todir="${build}/WEB-INF/lib">
      <fileset dir="libs" includes="*.jar">
        <exclude name="servlet.jar" />
        <exclude name="crimson.jar" />
        <exclude name="velocity-dep-1.3.1-rc2.jar" />
      </fileset>
    </copy>

  </target>

  <target name="deploy-firma" depends="build">

    <copy todir="${build-firma}">
      <fileset dir="web/firma" />
    </copy>

    <copy todir="${build-firma}/WEB-INF/classes">
      <fileset dir="${build}/WEB-INF/classes/">
       <include name="cz/abclinuxu/servlets/utils/DumpVelocityServlet.class" />
      </fileset>
    </copy>

    <copy todir="${build-firma}/WEB-INF/lib">
      <fileset dir="libs">
        <include name="velocity-dep-1.3.1-rc2.jar" />
        <include name="log4j.jar" />
      </fileset>
    </copy>

  </target>

  <target name="deploy" depends="deploy-firma,deploy-abc" />

</project>
