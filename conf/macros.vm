#####
## Macro, that synchronizes selected generic object with persistance
#####

#macro(sync $object)
#if(!$object.isInitialized()) $PERSISTANCE.synchronize($object)#end
#end



#####
## Macro, that displays parents of selected generic object
#####

#macro(parents)
#if($RELATION)
<div class="parents">
#foreach($parent in $PARENTS)
#if($velocityCount==1) #sync($parent.Parent)
<a href="$!URL.make("/ViewCategory?categoryId=$parent.Parent.Id")">$!UTIL.getXPath($parent.Parent,'data/name')</a>
#end
- <a href="$!URL.make("/ViewRelation?relationId=$parent.Id")">$!UTIL.getChildName($parent)</a>
#end</div>#end#end



#####
## Macro, that shows messages and generic errors
#####

#macro(showMessages)
#foreach ($msg in $MESSAGES)<div class="message">$msg</div>#set($found=true)#end
#if($!ERRORS.get('generic'))<div class="error">$ERRORS.get('generic')</div>#set($found=true)#end
#if($found)<br>#end
#end



#####
## Macro, that displays closed poll
#####

#macro(showClosedPoll $poll $displayCreated)
##
#sync($poll)
#set ($total = $poll.TotalVotes)
<table border="0" cellpadding="3">
<tr><td colspan=3 class="hlavicka_ankety">$!poll.Text</td></tr>
#####################################
#foreach ($choice in $poll.Choices)## Iterates over choices in poll
#####################################
#set($procento=$UTIL.percent($choice.Count,$total))
##
<tr><td class="volby_ankety">$choice.Text</td>
<td><img src="/images/site/poll.gif" height=11 width=$procento alt="$!UTIL.percentBar($procento)"></td>
<td class="volby_ankety">${procento}% ($choice.Count)</td></tr>
######
#end## end of iteration over poll choices
######
<tr><td colspan=2 class="vysledek_ankety">Celkem $total hlasù</td>
<td>
##
#if($USER.Id==1)
<a href="$!URL.make("/EditPoll?relationId=$RELATION.Id&pollId=$poll.Id&action=edit")">
<img src="/images/actions/pencil.png" alt="" border=0></a>
#end
##
</td></tr>
##
#if ($displayCreated)
<tr><td colspan=3>Vytvoøeno: $!UTIL.showDate($poll.Created)</td></tr>
#end
##
</table>
##
#end



#####
## Macro, that displays open poll
#####

#macro (showOpenPoll $poll $url)
#sync($poll)
#set ($total = $poll.TotalVotes)
<form action="$!URL.make('/EditPoll')" method="POST">
<table border="0" cellpadding="3">
<tr><td colspan=3 class="hlavicka_ankety">$!poll.Text</td></tr>
#####################################
#foreach ($choice in $poll.Choices)## Iterates choices in poll
#####################################
#set($procento=$UTIL.percent($choice.Count,$total))
##
<tr><td class="volby_ankety">
#if ( $poll.isMultiChoice() )
<input type="checkbox" name="voteId" value="$!choice.Id" #if($velocityCount==1) checked #end>
#else
<input type="radio" name="voteId" value="$!choice.Id" #if($velocityCount==1) checked #end>
#end
$choice.Text</td>
<td><img src="/images/site/poll.gif" height=11 width=$procento alt="$!UTIL.percentBar($procento)"></td>
<td class="volby_ankety">${procento}% ($choice.Count)</td></tr>
######
#end## end of iteration over poll choices
######
<tr><td colspan=2 class="vysledek_ankety">Celkem $total hlasù</td>
<td>
##
#if($USER.Id==1)
<a href="$!URL.make("/EditPoll?relationId=$RELATION.Id&pollId=$poll.Id&action=edit")">
<img src="/images/actions/pencil.png" alt="" border=0></a>
#end
##
</td></tr>
<tr><td colspan=2><input type="submit" value="Hlasuj"></td></tr>
</table>
##
$!UTIL.saveParams($PARAMS, [])
<input type="hidden" name="pollId" value="$!poll.Id">
<input type="hidden" name="url" value="$url">
<input type="hidden" name="action" value="vote">
</form>
#end



#####
## Macro, that shows article header
#####

#macro (showArticle $relation $separator)
#set($clanek=$relation.Child)
#set($author=$UTIL.instantiate('User',$!UTIL.getXPath($clanek,'/data/author')))
#sync($author)
<A CLASS="nadpis_out" HREF="$!URL.make("/clanky/ViewRelation?relationId=$relation.Id")">$!UTIL.getXPath($clanek,'/data/name')</A><BR>
<SPAN CLASS="barva">$!UTIL.showDate($!UTIL.getXPath($clanek,'/data/published')) |
<A HREF="mailto:$!author.Email">$!author.Name</A></SPAN>
<P class="perex_out">$!UTIL.getXPath($clanek,'/data/perex')</P>
<SPAN CLASS="barva">Pøeèteno: $!PERSISTANCE.getCounterValue($clanek)x </SPAN>
<BR><BR>
#if($separator)<IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" BORDER="0" ALT="---"><BR><BR>#end
#end