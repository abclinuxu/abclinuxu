#####
## Macro, that synchronizes selected generic object with persistance
#####

#macro(sync $object)
#if($object)
#if(!$object.isInitialized())$PERSISTANCE.synchronize($object)#end
#end
#end



#####
## Macro, that displays parents of selected generic object
#####

#macro(parents)
#if($RELATION)
<div class="parents">
#foreach($parent in $PARENTS)
#if($velocityCount==1) #sync($parent.Parent)
<a href="$!URL.make("/ViewCategory?categoryId=$parent.Parent.Id")">$!UTIL.getXPath($parent.Parent,'data/name')</a>
#end
- <a href="$!URL.make("/ViewRelation?relationId=$parent.Id")">$!UTIL.getChildName($parent)</a>
#end</div>#end#end



#####
## Macro, that shows messages and generic errors
#####

#macro(showMessages)
#foreach ($msg in $MESSAGES)<div class="message">$msg</div>#set($found=true)#end
#if($!ERRORS.get('generic'))<div class="error">$ERRORS.get('generic')</div>#set($found=true)#end
#if($found)<br>#end
#end



#####
## Macro, that displays closed poll
#####

#macro(showClosedPoll $poll $displayCreated)
##
#sync($poll)
#set ($total = $poll.TotalVotes)
<table border="0" cellpadding="3">
<tr><td colspan=3 class="hlavicka_ankety">$!poll.Text</td></tr>
#####################################
#foreach ($choice in $poll.Choices)## Iterates over choices in poll
#####################################
#set($procento=$UTIL.percent($choice.Count,$total))
##
<tr><td class="volby_ankety">$choice.Text</td>
<td><img src="/images/site/poll.gif" height=11 width=$procento alt="$!UTIL.percentBar($procento)"></td>
<td class="volby_ankety">${procento}% ($choice.Count)</td></tr>
######
#end## end of iteration over poll choices
######
<tr><td colspan=2 class="vysledek_ankety">Celkem $total hlasù</td>
<td>
##
#if($USER.Id==1)
<a href="$!URL.make("/EditPoll?relationId=$RELATION.Id&pollId=$poll.Id&action=edit")"><IMG SRC="/images/actions/pencil.png" BORDER="0" WIDTH="22" HEIGHT="22" ALT="Uprav"></a>
#end
##
</td></tr>
##
#if ($displayCreated)
<tr><td colspan=3>Vytvoøeno: $!UTIL.showDate($poll.Created)</td></tr>
#end
##
</table>
##
#end



#####
## Macro, that displays open poll
#####

#macro (showOpenPoll $poll $url)
#sync($poll)
#set ($total = $poll.TotalVotes)
<form action="$!URL.make('/EditPoll')" method="POST">
<table border="0" cellpadding="3">
<tr><td colspan=3 class="hlavicka_ankety">$!poll.Text</td></tr>
#####################################
#foreach ($choice in $poll.Choices)## Iterates choices in poll
#####################################
#set($procento=$UTIL.percent($choice.Count,$total))
##
<tr><td class="volby_ankety">
#if ( $poll.isMultiChoice() )
<input type="checkbox" name="voteId" value="$!choice.Id">
#else
<input type="radio" name="voteId" value="$!choice.Id">
#end
$choice.Text</td>
<td><img src="/images/site/poll.gif" height=11 width=$procento alt="$!UTIL.percentBar($procento)"></td>
<td class="volby_ankety">${procento}% ($choice.Count)</td></tr>
######
#end## end of iteration over poll choices
######
<tr><td colspan=2 class="vysledek_ankety">Celkem $total hlasù</td>
<td>
##
#if($USER.Id==1)
<a href="$!URL.make("/EditPoll?relationId=$RELATION.Id&pollId=$poll.Id&action=edit")"><IMG SRC="/images/actions/pencil.png" BORDER="0" WIDTH="22" HEIGHT="22" ALT="Uprav"></a>
#end
##
</td></tr>
<tr><td colspan=2><input type="submit" value="Hlasuj"></td></tr>
</table>
##
$!UTIL.saveParams($PARAMS, [])
<input type="hidden" name="pollId" value="$!poll.Id">
<input type="hidden" name="url" value="$url">
<input type="hidden" name="action" value="vote">
</form>
#end



#####
## Macro, that shows article header
#####

#macro (showArticle $relation $last)
#set($clanek=$relation.Child)
#set($dizs=$UTIL.filterDiscussions($clanek.Content))
#if($dizs.size()>0)#set($diz=$!UTIL.prepareDiscussion($dizs.get(0)))#undef('dizs')#end
#set($author=$UTIL.instantiate('User',$!UTIL.getXPath($clanek,'/data/author')))#sync($author)
<p>
<A CLASS="nadpis_out" HREF="/clanky/ViewRelation?relationId=$relation.Id">$!UTIL.getXPath($clanek,'/data/name')</A><BR>
<SPAN CLASS="barva">$!UTIL.showDate($!UTIL.getXPath($clanek,'/data/published')) |
<A HREF="/Profile?userId=$!author.Id">$!author.Name</A></SPAN>
</p>
<DIV class="perex_out">$!UTIL.getXPath($clanek,'/data/perex')</DIV>
<p>
<SPAN CLASS="barva">Pøeèteno: $!PERSISTANCE.getCounterValue($clanek)x
#if($diz)
| <a href="/clanky/ViewRelation?relationId=$!diz.RelationId">Komentáøù: $!diz.ResponseCount</a>
#if($diz.ResponseCount>0), poslední $UTIL.showDizDate($diz.LastUpdate)#end
#undef('diz')
#end
</SPAN><BR>
#if($last)
<IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" BORDER="0" ALT=""><BR>
<IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" VSPACE="1" BORDER="0" ALT=""><BR>
#else
<IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" BORDER="0" ALT="----------------------------------------">
#end
</p>
#end



#####
## Macro, that recursivly displays one thread
#####

#macro(thread $one $level $diz $relation)
#set($space=$level*15)
<div style="padding-left: $!{space}pt">
#comment($one.Record $diz $relation)
</div>
#foreach($child in $one.List)
#set($level2=$level+1)
#thread($child $level2 $diz $relation)
#end

#end



#####
## Macros, that shows one reaction in discussion
#####

#macro(comment $reaction $diz $relation)
<div class="diz_header">
<span class="diz_header_prefix">Datum:</span> $!UTIL.showDate($reaction.Updated)<br>
#if($reaction.Owner!=0)
#set($autor=$UTIL.instantiate('User',$reaction.Owner))#sync($autor)
<span class="diz_header_prefix">Od:</span> <A HREF="/Profile?userId=$!autor.Id">$!autor.Name</A><br>
#else
<span class="diz_header_prefix">Od:</span> $!UTIL.getXPath($reaction,'data/author')<br>
#end
<span class="diz_header_prefix">Titulek:</span> $!UTIL.getXPath($reaction,'data/title')<br>
</div>
<p>$UTIL.render($!UTIL.getXPath($reaction,'data/text'))<br>
<form action="$!URL.make("/EditDiscussion")" method="post">
<input type="hidden" name="action" value="add">
<input type="hidden" name="dizId" value="$!diz.Id">
<input type="hidden" name="relationId" value="$!relation.Id">
<input type="hidden" name="threadId" value=#if($UTIL.is($reaction,'Item','Discussion')) "0" #else "$!reaction.Id" #end>
<input type="submit" value="Odpovìdìt">
</form>
#if($reaction.Owner!=0) #showReward($autor) #end
#undef('autor')
</p>
#end



#####
## Macros, that deletes variable from context
#####

#macro(undef $name)
#set($ctx=$req.getAttribute('CONTEXT'))
#set($rqwty=$ctx.remove($name))
#end



#####
## Macros, that shows list of discussions
#####

#macro(showDiscussions $DISCUSSIONS $WHERE_ADD)
<TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="1" BORDER="0">

<TR><TD COLSPAN="3" CLASS="cerna2">
<STRONG>Diskuse</STRONG><A HREF="/hardware/ViewRelation?relationId=3739" TITLE="Diskusní fórum"><IMG SRC="/images/site/sipka.gif" WIDTH="11" HEIGHT="7" BORDER="0" ALT=" "></a><br>
</TD></TR>

<TR><TD COLSPAN="3"><A HREF="/hardware/EditDiscussion?action=addQuez&relationId=$WHERE_ADD">Polo¾it dotaz</A><BR></TD></TR>

<TR>
<TD CLASS="seda1"><SPAN CLASS="piditucna">Dotaz</SPAN></TD>
<TD CLASS="seda1" ALIGN="CENTER"><SPAN CLASS="piditucna">Odp.</SPAN></TD>
<TD CLASS="seda1" ALIGN="CENTER"><SPAN CLASS="piditucna">Poslední</SPAN></TD>
</TR>

#set($DIZS=$UTIL.sortByDateDescending($UTIL.getDiscussions($DISCUSSIONS)))

#foreach($diz in $DIZS)
<TR>
<TD><A HREF="/hardware/ViewRelation?relationId=$diz.RelationId">$UTIL.getXPath($diz.Discussion,'data/title')</A></TD>
<TD ALIGN="CENTER" VALIGN="MIDDLE"><SPAN CLASS="pidi">$diz.ResponseCount</SPAN></TD>
<TD ALIGN="CENTER" VALIGN="MIDDLE"><SPAN CLASS="pidi">$UTIL.showDizDate($diz.LastUpdate)</SPAN></TD>
</TR>

#if($velocityCount<$DIZS.size())
<TR><TD COLSPAN="3"><IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" BORDER="0" ALT="---"></TD></TR>
#end

#end

<TR><TD COLSPAN="3" CLASS="bezmezer">
<IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" BORDER="0" ALT=""><BR>
<IMG SRC="/images/site/sedybod.gif" WIDTH="100%" HEIGHT="1" BORDER="0" VSPACE="1" ALT=""><BR>
</TD></TR>

</TABLE>
#end



#####
## Macros, that shows reward form
#####

#macro (showReward $odmenen)
#set($penezenka=$UTIL.getXPath($odmenen,'data/ilikeq'))
#if($penezenka)
<form action="https://www.ilikeq.cz/ilikeq/usr/tnx.xsp" method="post">
<input type="hidden" name="name" value="$!penezenka">
<input type="hidden" name="descr" value="Zaslani odmeny">
<input type="hidden" name="detail1" value="Odmena za prispevek na AbcLinuxu.cz">
<input type="hidden" name="url" value="http://AbcLinuxu.cz/Reward?action=thanks&who=$!odmenen.Id">
<input type="hidden" name="curl" value="http://AbcLinuxu.cz/Reward?action=log&who=$!odmenen.Id">
<input type="submit" value="Zaslat odmìnu pøes I LIKE Q">
</form>
#undef('penezenka')
#end
#end
